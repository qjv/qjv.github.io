<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Text Formatter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        /* Custom scrollbar for a more game-like UI */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        .preview-link {
            color: #8ab4f8; /* A nice blue, similar to default link colors */
            text-decoration: underline;
            cursor: pointer;
        }
        .preview-link:hover {
            filter: brightness(1.2);
        }
        .btn-active {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-white">Game Text Formatter</h1>
            <p class="text-gray-400 mt-1">Create formatted messages with a live preview.</p>
        </div>

        <!-- Mode Selector -->
        <div class="flex justify-center items-center bg-gray-900 rounded-lg p-1 mb-6 max-w-sm mx-auto">
            <button id="mode-tag" class="w-1/2 py-2 px-4 rounded-md text-sm font-semibold transition-colors duration-200 btn-active">Tag Format (110)</button>
            <button id="mode-squad" class="w-1/2 py-2 px-4 rounded-md text-sm font-semibold transition-colors duration-200">Squad Message (200)</button>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Left Column: Editor & Controls -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="font-bold mb-2 text-white">Editor</h2>
                <div class="relative">
                    <textarea id="text-input" class="w-full h-48 bg-gray-800 border border-gray-700 rounded-md p-3 text-base resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Type your message here..."></textarea>
                    <div id="char-counter" class="absolute bottom-3 right-3 text-sm font-medium text-gray-400">0 / 110</div>
                </div>

                <div class="grid grid-cols-2 gap-3 mt-4">
                    <!-- Formatting Buttons -->
                    <button onclick="insertTag('a')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Link Style</button>
                    <button onclick="insertTag('br')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Line Break</button>
                    <button onclick="insertTag('pos')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Large Break</button>
                    
                    <!-- Color Picker -->
                    <div class="flex items-center bg-gray-700 rounded-lg">
                         <input type="color" id="color-picker" value="#55FF55" class="w-10 h-10 p-1 bg-transparent border-none cursor-pointer">
                         <button onclick="insertTag('c')" class="flex-grow text-white font-bold py-2 px-2 rounded-r-lg hover:bg-gray-600 transition">Apply Color</button>
                    </div>
                </div>
                 <button id="copy-button" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-transform duration-150 active:scale-95">
                    Copy to Clipboard
                </button>
            </div>

            <!-- Right Column: Preview -->
            <div class="bg-gray-900 p-4 rounded-lg flex flex-col h-full">
                <h2 class="font-bold mb-2 text-white flex-shrink-0">Live Preview</h2>
                <div id="preview-output" class="w-full flex-grow bg-gray-800 border border-gray-700 rounded-md p-3 overflow-y-auto break-words"></div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const previewOutput = document.getElementById('preview-output');
        const charCounter = document.getElementById('char-counter');
        const copyButton = document.getElementById('copy-button');
        const colorPicker = document.getElementById('color-picker');
        const modeTagBtn = document.getElementById('mode-tag');
        const modeSquadBtn = document.getElementById('mode-squad');

        let state = {
            mode: 'tag',
            limit: 110,
        };

        // --- Main Update Function ---
        function updateAll() {
            updatePreview();
            updateCharCounter();
        }

        // --- Preview Logic ---
        function updatePreview() {
            let rawText = textInput.value;
            let textForProcessing = rawText;

            // In squad mode, convert natural line breaks into <br> tags for processing
            if (state.mode === 'squad') {
                textForProcessing = textForProcessing.replace(/\n/g, '<br>');
            }

            // Sanitize to prevent unwanted HTML injection
            let sanitizedText = textForProcessing.replace(/</g, "&lt;").replace(/>/g, "&gt;");

            // Process our specific game tags
            let formattedText = sanitizedText
                .replace(/&lt;c=([a-fA-F0-9#]{7})&gt;(.*?)&lt;\/c&gt;/g, '<span style="color:$1">$2</span>')
                .replace(/&lt;a&gt;(.*?)&lt;\/a&gt;/g, '<span class="preview-link">$1</span>')
                .replace(/&lt;br&gt;/g, '<br>')
                .replace(/&lt;pos&gt;/g, '<br><br>');

            // Add prefix for squad mode
            if (state.mode === 'squad') {
                previewOutput.innerHTML = `<strong class="text-white">Squad Message:</strong> ${formattedText}`;
            } else {
                previewOutput.innerHTML = formattedText;
            }
        }

        // --- Character Counter Logic ---
        function updateCharCounter() {
            const count = textInput.value.length;
            charCounter.textContent = `${count} / ${state.limit}`;
            if (count > state.limit) {
                charCounter.classList.remove('text-gray-400');
                charCounter.classList.add('text-red-500');
            } else {
                charCounter.classList.add('text-gray-400');
                charCounter.classList.remove('text-red-500');
            }
        }

        // --- Tag Insertion Logic ---
        function insertTag(tag) {
            const start = textInput.selectionStart;
            const end = textInput.selectionEnd;
            const selectedText = textInput.value.substring(start, end);
            let newText = '';

            switch (tag) {
                case 'a':
                    newText = `<a>${selectedText}</a>`;
                    break;
                case 'c':
                    const color = colorPicker.value;
                    newText = `<c=${color}>${selectedText}</c>`;
                    break;
                case 'br':
                case 'pos':
                    newText = `<${tag}>`;
                    break;
            }

            // Insert the new text
            textInput.value = textInput.value.substring(0, start) + newText + textInput.value.substring(end);
            
            // Adjust cursor position
            if (selectedText.length === 0 && (tag === 'a' || tag === 'c')) {
                // If no text was selected, place cursor inside the tags
                textInput.focus();
                textInput.selectionStart = start + tag.length + (tag === 'c' ? 9 : 2);
                textInput.selectionEnd = textInput.selectionStart;
            } else {
                 textInput.focus();
                 textInput.selectionStart = start + newText.length;
                 textInput.selectionEnd = textInput.selectionStart;
            }

            updateAll();
        }

        // --- Mode Switching ---
        function setMode(mode) {
            state.mode = mode;
            state.limit = mode === 'tag' ? 110 : 200;
            
            if (mode === 'tag') {
                modeTagBtn.classList.add('btn-active');
                modeSquadBtn.classList.remove('btn-active');
            } else {
                modeSquadBtn.classList.add('btn-active');
                modeTagBtn.classList.remove('btn-active');
            }
            updateAll(); // Update preview when mode changes
        }
        
        // --- Event Listeners ---
        textInput.addEventListener('input', updateAll);
        
        // Prevent newlines in tag format mode
        textInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && state.mode === 'tag') {
                event.preventDefault();
            }
        });

        modeTagBtn.addEventListener('click', () => setMode('tag'));
        modeSquadBtn.addEventListener('click', () => setMode('squad'));

        copyButton.addEventListener('click', () => {
            // For squad mode, we need to copy the text with natural newlines, not <br> tags
            let textToCopy = textInput.value;
            if (state.mode === 'squad') {
                // The prefix is not part of the copied text
                textToCopy = textInput.value;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                const originalText = copyButton.textContent;
                copyButton.textContent = 'Copied!';
                copyButton.classList.add('bg-green-500', 'hover:bg-green-600');
                copyButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('bg-green-500', 'hover:bg-green-600');
                    copyButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 1500);
            });
        });

        // Initial call
        updateAll();
    </script>
</body>
</html>
